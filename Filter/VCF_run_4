$ ssh francine@fir.computecanada.ca
$ conda activate vcftools
$ cd /scratch/francine
$ mkdir VCF_run_4
$ cd VCF_run_4
create symlink
$ ln -s ~/def-sjsmith/francine_test/sockeye.vcf.gz sockeye.vcf.gz
confirm
$ ls -l sockeye.vcf.gz
# sockeye.vcf.gz -> /home/francine/def-sjsmith/francine_test/sockeye.vcf.gz

Step 0 - Remove 413
$vcftools --gzvcf sockeye.vcf.gz --remove-indv Oner_Bowron_2014_413.merged.dedup.bam --recode --recode-INFO-all --out filt_run4_0

#After filtering, kept 73 out of 74 Individuals
#Outputting VCF file...
#After filtering, kept 12813535 out of a possible 12813535 Sites

INPUT: sockeye.vcf.gz
OUTPUT: filt_run4_0.recode.vcf and filt_run4_0.log

STEP 1
$ vcftools --vcf filt_run4_0.recode.vcf --remove-indels --max-missing 0.5 --mac 3 --minQ 30 --recode --recode-INFO-all --out filt1_run4

# After filtering, kept 73 out of 73 Individuals
# Outputting VCF file...
# After filtering, kept 7265493 out of a possible 12813535 Sites

INPUT filt_run4_0.recode.vcf
OUTPUT filt1_run4.recode.vcf, filt1_run4.log


STEP 2
$ vcftools --vcf filt1_run4.recode.vcf --minDP 3 --recode --recode-INFO-all --out filt2_run4

INPUT filt1_run4.recode.vcf
OUTPUT filt2_run4.recode.vcf, fint2_run4.log

After filtering, kept 73 out of 73 Individuals
Outputting VCF file...
After filtering, kept 7265493 out of a possible 7265493 Sites

STEP 3

$ vcftools --vcf filt2_run4.recode.vcf --missing-indv --out filt3_run4

# After filtering, kept 73 out of 73 Individuals
# Outputting Individual Missingness
# After filtering, kept 7265493 out of a possible 7265493 Sites

INPUT filt2_run4.recode.vcf
OUTPUT filt3_run4.imiss, filt3_run4.log

$ awk '$5 > 0.5' filt3_run4.imiss | cut -f1 > lowDP_4.indv
less lowDP_4.indv

# INDV
# Oner_Horsefly_2018_540.merged.dedup.bam
# Oner_Horsefly_2018_542.merged.dedup.bam
# Oner_Horsefly_2021_511.merged.dedup.bam
# Oner_Horsefly_2021_515.merged.dedup.bam
# Oner_Horsefly_2021_519.merged.dedup.bam

OUTPUT: lowDP_4.indv

STEP 4
$ vcftools --vcf filt2_run4.recode.vcf --remove lowDP_4.indv --remove-indels --min-alleles 2 --max-alleles 2 --max-missing 0.75 --minDP 3 --recode --recode-INFO-all --out filt4_run4

# After filtering, kept 68 out of 73 Individuals
# Outputting VCF file...
# After filtering, kept 7053404 out of a possible 7265493 Sites

INPUT: filt2_run4.recode.vcf, lowDP_4.indv
OUTPUT: filt4_run4.recode.vcf, filt4_run4.log

STEP 5 
$ vcftools --vcf filt4_run4.recode.vcf --maf 0.01 --minGQ 10 --max-meanDP 200 --recode --recode-INFO-all --out filt5_run4

# After filtering, kept 68 out of 68 Individuals
# Outputting VCF file...
# After filtering, kept 7005639 out of a possible 7053404 Sites

INPUT: filt4_run4.recode.vcf
OUTPUT:filt5_run4.recode.vcf, filt5_run4.log

STEP 6 : 
$ vcftools --vcf filt5_run4.recode.vcf --remove-indels --min-alleles 2 --max-alleles 2 --max-missing 0.75 --maf 0.01 --minDP 3 --minGQ 10 --recode --recode-INFO-all --out filt6_run4

# After filtering, kept 68 out of 68 Individuals
Outputting VCF file...
After filtering, kept 7005639 out of a possible 7005639 Sites

INPUT: filt5_run4.recode.vcf
OUTPUT: filt6_run4.recode.vcf, filt6_run4.log


FINAL CHECK
$ grep -v '^#' filt6_run4.recode.vcf | wc -l
# 7005639

Create before.txt and after.txt

$ nano before.txt
copy from excel
$ control+o, enter
$ control+x
$ cat before.txt 
# gives me the list 

repeate for after 

Create VCF filt_before

$ vcftools --vcf filt6_run4.recode.vcf --keep before.txt --recode --recode-INFO-all --out filt_before
OUTPUT: filt_before.recode.vcf, filt_before.log

#After filtering, kept 30 out of 68 Individuals
#Outputting VCF file...
#After filtering, kept 7005639 out of a possible 7005639 Sites

Create VCF filt_after

$ vcftools --vcf filt6_run4.recode.vcf --keep after.txt --recode --recode-INFO-all --out filt_after

OUTPUT: filt_after.recode.vcf, filt_after.log 
$After filtering, kept 38 out of 68 Individuals
$Outputting VCF file...
$After filtering, kept 7005639 out of a possible 7005639 Sites


I moved myself back into francine_test 
copied the 2 files in there. ( the final dot makes the file I copied go into the file I am at currently )
$ cp /scratch/francine/VCF_run_4/filt_before.recode.vcf /scratch/francine/VCF_run_4/filt_after.recode.vcf .
